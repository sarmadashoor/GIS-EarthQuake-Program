ContactForm=function(e){this._options={dialog:{autoOpen:true,draggable:true,resizable:true,modal:true,title:"Contact Us",close:this.getCloseContactCallback(),width:Math.min(850,$("body").width()-50),height:Math.min(540,$("body").height()-50),zIndex:10001}};for(var t in e){this._options[t]=e[t]}this._dialog=null;this._validator=new ContactValidator(this);this._faqfilter=null};ContactForm.prototype.renderFAQ=function(){var e=this;$.ajax({url:"http://www.usgs.gov/faq/services/getCategoryQuestions.php?category=9762",jsonpCallback:"earthquake",dataType:"jsonp",success:function(t){var n='<h4 class="search">'+t.categoryName+"</h4><ul>";for(var r=0;r<t.categoryFaqs.length;r++){n+='<li class="search"><a href="'+t.categoryFaqs[r].url+'" target="_blank">'+t.categoryFaqs[r].question+"</a></li>"}n+="</ul>";for(var r=0;r<t.subCategories.length;r++){if(typeof t.subCategories[r]=="object"){n+='<h4 class="search">'+t.subCategories[r].categoryName+"</h4><ul>";for(var i=0;i<t.subCategories[r].categoryFaqs.length;i++){n+='<li class="search"><a href="'+t.subCategories[r].categoryFaqs[i].url+'" target="_blank">'+t.subCategories[r].categoryFaqs[i].question+"</a></li>"}for(var i=0;i<t.subCategories[r].subCategories.length;i++){if(typeof t.subCategories[r].subCategories[i]=="object"){n+='<li class="search"><strong class="subcategory">'+t.subCategories[r].subCategories[i].categoryName+"</strong><ul>";for(var s=0;s<t.subCategories[r].subCategories[i].categoryFaqs.length;s++){n+='<li class="search"><a href="'+t.subCategories[r].subCategories[i].categoryFaqs[s].url+'" target="_blank">'+t.subCategories[r].subCategories[i].categoryFaqs[s].question+"</a></li>"}n+="</ul></li>"}}n+="</li></ul>"}}$("#contactform_faq_questions").html(n);e._faqfilter=new FAQFilter("#contactform_faq_questions");$("#contact_subject").keyup(function(t){e._faqfilter.update($(this).val())}).keyup()}})};ContactForm.prototype.getOpenContactCallback=function(){var e=this;return function(t){e._appendCss();$.ajax({url:$(this).attr("href"),method:"GET",cache:false,data:{ajax:"true"},success:e.getCreateDialog(),error:e.handleAjaxError});return false}};ContactForm.prototype._appendCss=function(){if($("#contactformcss").length==0){$("head").append('<link id="contactformcss" rel="stylesheet" media="all" '+'href="/contactus/css/contactform.css"/>')}};ContactForm.prototype.getCloseContactCallback=function(){var e=this;return function(){try{$(e._dialog).dialog("destroy");$(this).remove()}catch(t){}e._dialog=null}};ContactForm.prototype.getCreateDialog=function(){var e=this;return function(t,n,r){if(e._dialog||$("#contactform").length>0){$(e._dialog).dialog("close")}e._dialog=$(t).dialog(e._options["dialog"]);e.renderFAQ();e._bindValidator();var i=[];$("option",$("#contact_subject_autocomplete")).each(function(){i.push($(this).val())});$("#contact_subject").autocomplete({delay:250,source:i,select:function(e,t){$(this).val(t.item.label);$(this).keyup()}})}};ContactForm.prototype._bindValidator=function(){$("#contact_email").blur(this._validator.getValidateEmail());$("#contact_subject").blur(this._validator.getValidateSubject());$("#contact_message").blur(this._validator.getValidateMessage());$("#contactform_form").submit(this._validator.getValidateSubmit())};ContactForm.prototype.submitForm=function(e){var t=$(e).attr("action");var n=[$(e).serialize(),"ajax=true","submit=Send+Message"].join("&");$(this._dialog).dialog("close");$.ajax({url:t,method:"POST",cache:false,data:n,success:this.getCreateDialog(),error:this.handleAjaxError});return false};ContactForm.prototype.handleAjaxError=function(e,t,n){alert(["An error occurred while fetching data from the server. (",t,"). Please try again."].join(""))};ContactValidator=function(e){this._contactForm=e};ContactValidator.prototype.getValidateEmail=function(){var e=this;return function(e){var t=$(this).val();if(t!=""&&!t.match(/^[\S]+@[\S]+\.[\S]+$/)){$(this).parent("li").append(['<span class="inputError">',"You must either omit the email address or ","enter a valid email address.","</span>"].join(""))}else{try{$(".inputError",$(this).parent("li")).remove()}catch(n){}}}};ContactValidator.prototype.getValidateSubject=function(){var e=this;return function(e){var t=$(this).val();if(t==""){$(this).parent("li").append(['<span class="inputError">',"You must enter a subject.","</span>"].join(""))}else{try{$(".inputError",$(this).parent("li")).remove()}catch(n){}}}};ContactValidator.prototype.getValidateMessage=function(){var e=this;return function(e){var t=$(this).val();if(t==""){$(this).parent("li").append(['<span class="inputError">',"You must enter a message.","</span>"].join(""))}else{try{$(".inputError",$(this).parent("li")).remove()}catch(n){}}}};ContactValidator.prototype.getValidateSubmit=function(){var e=this;return function(t){var n=[$("#contact_email").get(0),$("#contact_subject").get(0),$("#contact_message").get(0)];for(var r=0,i;i=n[r];++r){$(i).blur()}try{if($(".inputError",$(this)).length==0){e._contactForm.submitForm(this)}}catch(s){}return false}};FAQFilter=function(e){this.el=$(e);this.noResults='<p class="noresults">No Results</p>'};FAQFilter.prototype.test=function(e,t){var n=t.length;var r=true;for(var i=0;i<n;i++){if(e.indexOf(t[i])==-1){r=false;break}}return r};FAQFilter.prototype.update=function(e){var t=this;if(e==""){$("*",t.el).show();$(".noresults",t.el.parent("div")).remove();return}var n=e.toLowerCase().replace(/\b[\w']{1,3}\b/g," ").replace(/\bwhere\b/g," ").replace(/\bfind\b/g," ").replace(/\blooking\b/g," ").replace(/\s{2,}/," ").replace(/^\s+/,"").replace(/\s+$/,"").split(" ");$("h4",t.el).each(function(){var e=$(this);var r=e.next("ul");var i=t.test(e.text().toLowerCase(),n);if(i){e.show();r.show();$("*",r).show();return}var s=$("strong.subcategory",r);var o=false;$("a",r).each(function(){var e=$(this);if(t.test(e.text().toLowerCase(),n)){o=true;e.parent("li").show()}else{e.parent("li").hide()}});if(!o){e.hide();r.hide()}else{e.show();r.show()}if(s.length!=0){var u=false;s.each(function(){var e=$(this);var r=e.next("ul");var i=false;if(t.test(e.text().toLowerCase(),n)){i=true;e.parent("li").show();$("*",r).show()}else{var s=false;$("a",r).each(function(){var e=$(this);if(t.test(e.text().toLowerCase(),n)){s=true;e.parent("li").show()}else{e.parent("li").hide()}});if(s){i=true}}if(i){u=true;e.parent("li").show()}else{e.parent("li").hide()}});if(u){e.show();r.show()}else{e.hide();r.hide()}}});if($(":visible",t.el).length==0){if($(".noresults",t.el.parent("div")).length==0){$(t.el.parent("div")).append(t.noResults)}}else{$(".noresults",t.el.parent("div")).remove()}};var handler=null;$(document).ready(function(e){handler=new ContactForm({});$('a[href^="/contactus/?"]').click(handler.getOpenContactCallback());$('a[href^="/contactus/index"]').click(handler.getOpenContactCallback())})